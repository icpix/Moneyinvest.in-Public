
<html>
<head>
    <meta charset="UTF-8">
    <title>XIRR Calculator</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ccc;
        }
        input {
            width: 100%;
            box-sizing: border-box;
            padding: 5px;
        }
        button {
      background-color: #4CAF50;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 3px;
      cursor: pointer;
        }
/* Responsive Design */
        @media (max-width: 600px) {
            body {
                padding: 10px;
                flex-direction: column;
                height: auto;
                font-size: 12px; /* Even smaller font size for mobile */
            }
            table, .buttons, .result {
                width: 100%;
                max-width: none;
            }
            input[type="date"], input[type="text"], button {
                font-size: 12px;
                padding: 7px;
                width: 100%; /* Making input fields wider */
            }
          input[type="date"]{
          min-width:100px;
         }
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <table id="cashflow-table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Cash Flow</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <!-- A default row -->
            <tr>
                <td><input type="date" class="date-input"></td>
                <td><input type="number" class="cashflow-input"></td>
                <td><button onclick="deleteRow(this)">Delete</button></td>
            </tr>
             <tr>
                <td><input type="date" class="date-input"></td>
                <td><input type="number" class="cashflow-input"></td>
                <td><button onclick="deleteRow(this)">Delete</button></td>
            </tr>
<tr>
                <td><input type="date" class="date-input"></td>
                <td><input type="number" class="cashflow-input"></td>
                <td><button onclick="deleteRow(this)">Delete</button></td>
            </tr>
<tr>
                <td><input type="date" class="date-input"></td>
                <td><input type="number" class="cashflow-input"></td>
                <td><button onclick="deleteRow(this)">Delete</button></td>
            </tr>
        </tbody>
    </table>
    <br/>
    <button onclick="addRow()">Add Row</button>
<br/> <br/>
    <button onclick="calculateXIRR()">Calculate XIRR</button>
<br/>
<br/>
<p>XIRR Result: <span id="xirr-result" style="font-weight: bold;"/span></p>

<br/>
<p>Absolute Percentage: <span id="absolute-percentage" style="font-weight: bold;"/span></p>

    <br/>
    <br/>

<a href="https://moneyinvest.in/financial-tools/" target="_blank" rel="noopener">For other Financial Tools</a>
   </a>
<script>
        function addRow() {
            const newRow = `
                <tr>
                    <td><input type="date" class="date-input"></td>
                    <td><input type="number" class="cashflow-input"></td>
                    <td><button onclick="deleteRow(this)">Delete</button></td>
                </tr>
            `;
            document.getElementById('cashflow-table').insertAdjacentHTML('beforeend', newRow);
        }

        function deleteRow(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }

        function calculateXIRR() {
            const dateInputs = document.querySelectorAll('.date-input');
            const cashflowInputs = document.querySelectorAll('.cashflow-input');
            const cashflows = [];

            for (let i = 0; i < dateInputs.length; i++) {
                const date = dateInputs[i].value;
                const cashflow = parseFloat(cashflowInputs[i].value);
                if (!isNaN(cashflow)) {
                    cashflows.push({ date, cashflow });
                }
            }

            if (cashflows.length < 2) {
                alert('Please enter at least two cash flows to calculate XIRR.');
                return;
            }

            const xirrResult = calculateXIRRFunction(cashflows);
            const absolutePercentage = calculateAbsolutePercentage(cashflows);
            
            if (!isNaN(xirrResult)) {
                document.getElementById('xirr-result').textContent = (xirrResult * 100).toFixed(2) + "%";
            } else {
                alert('XIRR calculation did not converge. Please check your cash flows.');
            }
            
            if (!isNaN(absolutePercentage)) {
                document.getElementById('absolute-percentage').textContent = absolutePercentage.toFixed(2) + "%";
            } else {
                document.getElementById('absolute-percentage').textContent = 'Calculation Error';
            }
        }

        function calculateXIRRFunction(cashflows) {
            const MAX_ITERATIONS = 1000;
            const PRECISION = 0.000001;
            let guess = 0.1;

            for (let i = 0; i < MAX_ITERATIONS; i++) {
                let x0 = guess;
                let fValue = 0;
                let fDerivative = 0;

                for (let j = 0; j < cashflows.length; j++) {
                    const days = (new Date(cashflows[j].date) - new Date(cashflows[0].date)) / (1000 * 60 * 60 * 24);
                    fValue += cashflows[j].cashflow / Math.pow(1 + x0, days / 365);
                    fDerivative -= (days / 365) * cashflows[j].cashflow / Math.pow(1 + x0, (days / 365) + 1);
                }

                guess = x0 - fValue / fDerivative;

                if (Math.abs(guess - x0) < PRECISION) {
                    return guess;
                }
            }

            return NaN; // Failed to converge
        }

        function calculateAbsolutePercentage(cashflows) {
            let totalInflow = 0;
            let totalOutflow = 0;

            cashflows.forEach(cf => {
                if (cf.cashflow > 0) {
                    totalInflow += cf.cashflow;
                } else {
                    totalOutflow += cf.cashflow;
                }
            });

            const absoluteReturn = totalInflow + totalOutflow;
            const absolutePercentage = (absoluteReturn / Math.abs(totalOutflow)) * 100;

            return absolutePercentage;
        }
    </script>
</body>
</html>
